#Реалізація сервісу роботи з JWT-токенами

У цьому проєкті реалізовано сервіс генерації, перевірки, оновлення та інвалідації JWT-токенів у Spring Boot застосунку.  
Токен використовується для авторизації користувачів та доступу до захищених ендпойнтів.

## Використані технології
- Java 11  
- Spring Boot  
- Spring Security  
- JWT (jjwt)  
- Maven  
- Lombok  
## Генерація токену
Генерація токену виконується у класі `JwtTokenServiceTest` у пакеті `services.token` методом  
`generateToken(String username, Map<String, Object> userMetadata)`.
У токен записуються такі дані:
- логін користувача (username);
- метадані користувача (user_id, role);
- назва додатку (jwt.app.name);
- час створення токену;
- час закінчення дії токену.

Термін дії токену налаштовується у файлі `application.properties`:
jwt.expiration.ms=3600000

## Використання токену при реєстрації
Контролер: `AuthController`  
Ендпойнт:
POST /auth/register

Після успішної реєстрації користувача:
- формується об’єкт `AuthRegisterRequest`;
- створюється JWT-токен;
- клієнту повертається відповідь `AuthRegisterResponse` з токеном;
- у систему записуються лог-повідомлення.

Логіка реалізована у класі `AuthenticationServiceImpl`.

## Використання токену при логіні

Контролер: `AuthController`  
Ендпойнт:
POST /auth/login
Після успішного входу:

- формується `AuthLoginRequest`;
- створюється новий JWT-токен;
- клієнту повертається `AuthLoginResponse` з токеном;
- виконується логування події.

## Перевірка токену (JwtAuthFilter)

Перевірка токену реалізована у класі `JwtAuthFilter` у пакеті `security`.
Фільтр виконує такі дії:
- зчитує токен з заголовка `Authorization`;
- перевіряє коректність підпису;
- перевіряє термін дії;
- перевіряє, чи токен не знаходиться у чорному списку;
- отримує username та метадані;
- додає їх у `request`;
- створює об’єкт автентифікації у Spring Security;
- дозволяє доступ до захищених ендпойнтів.

## Кастомна анотація @Secured

У пакеті `annotations` створена кастомна анотація `@Secured`.
Вона сигналізує, що доступ до ендпойнту можливий **тільки при наявності валідного JWT-токену**.
Використовується у класі `TokenController` для захисту:
- оновлення токену;
- інвалідації токену.

## Оновлення токену

Контролер: `TokenController`  
Ендпойнт:
POST /api/token/refresh

Працює тільки при наявності валідного токену.
Логіка роботи:
- з `request` зчитується username та метадані;
- створюється новий JWT-токен;
- новий токен повертається клієнту.

##Інвалідація токену (лог-аут)

Контролер: `TokenController`  
Ендпойнт:
POST /api/token/invalidate

- токен зчитується з `Authorization`;
- передається у сервіс;
- додається у чорний список;
- після цього більше не приймається сервером.

## Чорний список токенів

Чорний список реалізований у класі `JwtTokenServiceTest` через `ConcurrentHashMap`.

Інвалідовані токени зберігаються там до завершення терміну їх дії.

## Захищені ендпойнти

Усі ендпойнти, окрім `/auth/**`, є захищеними.

Налаштування безпеки виконано у класі `SecurityConfig`.

Для доступу до будь-якого захищеного ендпойнту потрібен валідний JWT-токен.

## Передача метаданих у контролери

У фільтрі `JwtAuthFilter` у запит додаються:
- username;
- userMetadata.

У контролерах ці дані отримуються через `@RequestAttribute`.

## Логування 
У проєкті реалізовано логування подій:
- генерація токену;
- успішний логін;
- реєстрація користувача;
- прострочення токену;
- інвалідація токену.

Для логування використовується бібліотека `SLF4J`.

## Налаштування application.properties

У файлі `application.properties` задані такі параметри:

spring.application.name=Bank
jwt.secret.key=...
jwt.expiration.ms=3600000
jwt.app.name=BankApplication
